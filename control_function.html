<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
	inlineMath: [['$','$']],
	processEscapes: true
	}
});
</script>
<script type="text/javascript" async 
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
</script>
<h1><a href="#control-function" id="control-function">Control Function</a></h1>
<h3><a href="#isaac-m" id="isaac-m">Isaac M</a></h3>
<hr />
<pre><code>. import delimited &quot;https://raw.githubusercontent.com/isaacmeza/control_function_example/main/DB/cf_pactor_sett.csv&quot;
&gt; , clear  case(preserve)
(encoding automatically selected: ISO-8859-1)
(19 vars, 1,732 obs)

</code></pre>
<h3><a href="#constrained-model-constant-coefficients" id="constrained-model-constant-coefficients">Constrained model - Constant Coefficients</a></h3>
<p>The model of interest is $$ y_j = x_j\beta +\delta t_j+\epsilon_j$$</p>
<p>where $t_j$ is a binary-treatment variable generated by an unobservable latent model: $$t_j = 1[w_j\gamma + u_j&gt;0]$$ and $\epsilon$, $u$ are bivariate normal with mean zero and covariance matrix $$ \begin{bmatrix} \sigma^2 &amp; \rho\sigma\ \rho\sigma &amp; 1 \end{bmatrix}$$</p>
<h3><a href="#general-potential-outcome-model-correlated-random-coefficient" id="general-potential-outcome-model-correlated-random-coefficient">General potential outcome model - Correlated Random Coefficient</a></h3>
<p>The setup of the previous section allows the endogenous explanatory variable or variables to appear linearly or nonlinearly and to interact with observed covariates. This may be sufficient for some applications, but one may also want to allow the effect of y2 to depend on unobs</p>
<p>ved fully. When one allows random coefficients to be correlated with some explanatory variables, such as amount of school or choice of school, one obtains a &ldquo;correlated random coefficient&rdquo; (CRC) model, a label adopted by Heckman and Vytlacil (1998) and discussed in the context of the return to schooling by Card (2001). In the treatment effects literature, CRC models allow for heterogeneous treatment effects combined with self-selection into treatment â€”provided that there are suitable instrumental variables for treatment as signment</p>
<p>The recent literature on instrumental variables (IV) features models in which agents sort into treatment status on the basis of gains from treatment as well as on baseline-pretreatment levels. Components of the gains known to the agents and acted on by them may not be known by the observing economist. Such models are called correlated random coefficient models.</p>
<pre><code>ivregress 2sls seconcilio altT d_anio* d_num* d_junta* phase (p_actor interactT = i.time_hr##i.altT), vce(cluster cluster_v)   
</code></pre>
<pre><code>note: 1.altT omitted because of collinearity.

Instrumental variables 2SLS regression            Number of obs   =      1,723
                                                  Wald chi2(16)   =     164.80
                                                  Prob &gt; chi2     =     0.0000
                                                  R-squared       =     0.0722
                                                  Root MSE        =     .34909

                            (Std. err. adjusted for 700 clusters in cluster_v)
------------------------------------------------------------------------------
             |               Robust
  seconcilio | Coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
     p_actor |   .3764376   .3203994     1.17   0.240    -.2515337    1.004409
   interactT |   .1582707   .4313301     0.37   0.714    -.6871207    1.003662
        altT |   .0047817   .0828154     0.06   0.954    -.1575335    .1670969
    d_anioC2 |  -.0431707   .0353022    -1.22   0.221    -.1123618    .0260204
    d_anioC3 |  -.0781149   .0601744    -1.30   0.194    -.1960546    .0398248
    d_anioC4 |   -.027374    .044538    -0.61   0.539    -.1146669    .0599189
    d_anioC5 |  -.0537756   .0471267    -1.14   0.254    -.1461422     .038591
    d_anioC6 |  -.0073023   .0640302    -0.11   0.909    -.1327992    .1181947
    d_anioC7 |   .0155657   .0840653     0.19   0.853    -.1491993    .1803308
      d_num2 |    .012786   .0427567     0.30   0.765    -.0710155    .0965876
      d_num3 |  -.0249497   .0347275    -0.72   0.472    -.0930144     .043115
    d_junta2 |  -.0111277   .0446982    -0.25   0.803    -.0987345    .0764792
    d_junta3 |  -.0188805   .0351032    -0.54   0.591    -.0876814    .0499205
    d_junta4 |   .2024814   .0379855     5.33   0.000     .1280312    .2769315
    d_junta5 |  -.0636965   .0363869    -1.75   0.080    -.1350135    .0076205
       phase |   .0231708   .0544132     0.43   0.670     -.083477    .1298187
       _cons |   .0075994   .1011457     0.08   0.940    -.1906425    .2058412
------------------------------------------------------------------------------
Instrumented: p_actor interactT
 Instruments: altT d_anioC2 d_anioC3 d_anioC4 d_anioC5 d_anioC6 d_anioC7
              d_num2 d_num3 d_junta2 d_junta3 d_junta4 d_junta5 phase
              2.time_hr 3.time_hr 4.time_hr 5.time_hr 6.time_hr 7.time_hr
              8.time_hr 2.time_hr#1.altT 3.time_hr#1.altT 4.time_hr#1.altT
              5.time_hr#1.altT 6.time_hr#1.altT 7.time_hr#1.altT
              8.time_hr#1.altT

</code></pre>
<p>etregress seconcilio altT i.anioControl i.numActores i.junta i.phase , treat(p_actor = i.time_hr altT i.anioControl i.numActores i.junta i.phase) twostep first</p>
<p>*Probit (FS) probit p_actor i.altT time_hr2-time_hr8 i.anioControl i.numActores i.junta i.phase if e(sample) cap drop xb predict xb, xb *Generalized residuals cap drop gen_resid_pr gen gen_resid_pr = cond(p_actor == 1, normalden(xb)/normal(xb), -normalden(xb)/(1-normal(xb)))</p>
<p>*CF *Probit - Interaction</p>
<p>eststo clear</p>
<p>gen esample = e(sample)</p>
<p>eststo : reg seconcilio altT p_actor   i.anioControl i.numActores i.junta i.phase gen_resid_p</p>
<p>eststo : reg seconcilio altT i.p_actor##c.gen_resid_p   i.anioControl i.numActores i.junta i.phase</p>
<p>eststo : reg seconcilio altT p_actor interactT  i.anioControl i.numActores i.junta i.phase gen_resid_p</p>
<p>*CRC</p>
<p>eststo : reg seconcilio altT i.p_actor##c.gen_resid_p interactT  i.anioControl i.numActores i.junta i.phase</p>
<p>etregress seconcilio i.altT##i.p_actor i.anioControl i.numActores i.junta i.phase , treat(p_actor = i.time_hr altT i.anioControl i.numActores i.junta i.phase) twostep</p>
<p>etregress seconcilio i.altT##i.p_actor i.anioControl i.numActores i.junta i.phase , treat(p_actor = i.time_hr altT i.anioControl i.numActores i.junta i.phase)  cfunction  poutcomes</p>
<p>etregress seconcilio i.altT##i.p_actor i.anioControl i.numActores i.junta i.phase , treat(p_actor = i.time_hr altT i.anioControl i.numActores i.junta i.phase)    poutcomes</p>
<pre><code>etregress seconcilio i.altT##i.p_actor i.anioControl i.numActores i.junta i.phase , treat(p_actor = i.time_hr altT i.anioControl i.numActores i.junta i.phase)  cfunction  
</code></pre>
<p>etregress seconcilio i.altT##i.p_actor i.anioControl i.numActores i.junta i.phase , treat(p_actor = i.time_hr altT i.anioControl i.numActores i.junta i.phase)</p>
<p>reg p_actor  i.altT##i.time_hr i.anioControl i.numActores i.junta i.phase if esample cap drop p1 predict p1 reg interactT i.altT##i.time_hr i.anioControl i.numActores i.junta i.phase if esample cap drop p2 predict p2</p>
<p>reg seconcilio altT p1 p2 i.anioControl i.numActores i.junta i.phase if esample</p>
<p>ivregress 2sls seconcilio altT   i.anioControl i.numActores i.junta i.phase (p_actor  = i.time_hr), first</p>
<p>probit p_actor  i.altT time_hr2-time_hr8 d_anio* d_num* d_junta* phase cap drop p1 predict p1</p>
<p>reg seconcilio altT p1 d_anio* d_num* d_junta* phase</p>
<p>cap drop pint su altT gen pint = p1*(altT-`r(mean)&rsquo;) reg seconcilio altT p1 pint d_anio* d_num* d_junta* phase</p>
<p>ivtreatreg seconcilio p_actor altT d_anio* d_num* d_junta* phase , model(direct-2sls) iv(time_hr2-time_hr8) hetero(altT)</p>
<p>ivtreatreg seconcilio p_actor altT d_anio* d_num* d_junta* phase, model(probit-ols) iv(time_hr2-time_hr8) hetero(altT)</p>
<p>di   e(ate)<br />
di   e(atet) di  e(atent)</p>
<p>ivtreatreg seconcilio p_actor altT d_anio* d_num* d_junta* phase, model(probit-2sls) iv(time_hr2-time_hr8) hetero(altT)</p>
<p>ivtreatreg seconcilio p_actor altT d_anio* d_num* d_junta* phase, model(heckit) iv(time_hr2-time_hr8) hetero(altT)</p>
<p>ivtreatreg seconcilio p_actor altT d_anio* d_num* d_junta* phase, model(heckit) iv(time_hr2-time_hr8) hetero(altT)</p>
<p>&laquo;/dd_do&raquo;</p>
<pre><code>
el mate 
$$\mathbb{E}[x-y]$$

pero es igual que $a-v$ sdfsdfdfg

y entonces se da que 
</code></pre>
